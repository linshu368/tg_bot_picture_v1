# Telegram Bot V2 é¡¹ç›®ç»“æ„å›¾

## æ•´ä½“æ¶æ„å±‚æ¬¡å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ç”¨æˆ·äº¤äº’å±‚                                 â”‚
â”‚                    (External Users)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      æ¥å£é€‚é…å±‚                                   â”‚
â”‚                 (Interface Layer)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚  Telegram   â”‚  â”‚     Web     â”‚  â”‚     CLI     â”‚              â”‚
â”‚  â”‚ Interface   â”‚  â”‚ Interface   â”‚  â”‚ Interface   â”‚              â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚              â”‚
â”‚  â”‚ â€¢ bot.py    â”‚  â”‚ â€¢ routes    â”‚  â”‚ â€¢ commands  â”‚              â”‚
â”‚  â”‚ â€¢ handlers/ â”‚  â”‚ â€¢ controllersâ”‚  â”‚ â€¢ scripts   â”‚              â”‚
â”‚  â”‚ â€¢ ui_handlerâ”‚  â”‚             â”‚  â”‚             â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åº”ç”¨æ ¸å¿ƒå±‚                                   â”‚
â”‚                   (Application Core)                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚ Container   â”‚  â”‚ Application â”‚  â”‚ Lifecycle   â”‚              â”‚
â”‚  â”‚ (DIå®¹å™¨)    â”‚  â”‚ (åº”ç”¨é€»è¾‘)   â”‚  â”‚ (ç”Ÿå‘½å‘¨æœŸ)   â”‚              â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚              â”‚
â”‚  â”‚ â€¢ ä¾èµ–æ³¨å…¥   â”‚  â”‚ â€¢ åº”ç”¨å¯åŠ¨   â”‚  â”‚ â€¢ å¯åŠ¨é’©å­   â”‚              â”‚
â”‚  â”‚ â€¢ æœåŠ¡æ³¨å†Œ   â”‚  â”‚ â€¢ é…ç½®ç®¡ç†   â”‚  â”‚ â€¢ å…³é—­é’©å­   â”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        é¢†åŸŸå±‚                                    â”‚
â”‚                    (Domain Layer)                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚      Models         â”‚  â”‚           Services                  â”‚â”‚
â”‚  â”‚     (å®ä½“æ¨¡å‹)       â”‚  â”‚         (é¢†åŸŸæœåŠ¡)                  â”‚â”‚
â”‚  â”‚                     â”‚  â”‚                                     â”‚â”‚
â”‚  â”‚ â€¢ User              â”‚  â”‚ â€¢ user_service.py                   â”‚â”‚
â”‚  â”‚ â€¢ Payment           â”‚  â”‚ â€¢ payment_service.py                â”‚â”‚
â”‚  â”‚ â€¢ Image             â”‚  â”‚ â€¢ image_service.py                  â”‚â”‚
â”‚  â”‚ â€¢ Session           â”‚  â”‚ â€¢ session_service.py                â”‚â”‚
â”‚  â”‚ â€¢ SystemConfig      â”‚  â”‚ â€¢ system_config_service.py          â”‚â”‚
â”‚  â”‚                     â”‚  â”‚ â€¢ action_record_service.py          â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      åŸºç¡€è®¾æ–½å±‚                                   â”‚
â”‚                 (Infrastructure Layer)                          â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  Database   â”‚ â”‚External APIsâ”‚ â”‚ Messaging   â”‚ â”‚ Monitoring  â”‚ â”‚
â”‚ â”‚   (æ•°æ®åº“)   â”‚ â”‚  (å¤–éƒ¨API)   â”‚ â”‚   (æ¶ˆæ¯)     â”‚ â”‚   (ç›‘æ§)     â”‚ â”‚
â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â”‚â€¢ Supabase   â”‚ â”‚â€¢ ClothOff   â”‚ â”‚â€¢ Queue      â”‚ â”‚â€¢ Logging    â”‚ â”‚
â”‚ â”‚â€¢ Repositoriesâ”‚ â”‚â€¢ Payment    â”‚ â”‚â€¢ Events     â”‚ â”‚â€¢ Metrics    â”‚ â”‚
â”‚ â”‚  - User     â”‚ â”‚  APIs       â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â”‚  - Payment  â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â”‚  - Image    â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â”‚  - Session  â”‚ â”‚             â”‚ â”‚             â”‚ â”‚             â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å·¥å…·å±‚                                      â”‚
â”‚                   (Utilities Layer)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚  â”‚   Config    â”‚  â”‚  Constants  â”‚  â”‚   Helpers   â”‚              â”‚
â”‚  â”‚   (é…ç½®)     â”‚  â”‚   (å¸¸é‡)     â”‚  â”‚  (å¸®åŠ©å‡½æ•°)  â”‚              â”‚
â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚              â”‚
â”‚  â”‚ â€¢ Settings  â”‚  â”‚ â€¢ Messages  â”‚  â”‚ â€¢ Utils     â”‚              â”‚
â”‚  â”‚ â€¢ Environmentâ”‚  â”‚ â€¢ Status    â”‚  â”‚ â€¢ Validatorsâ”‚              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## è¯¦ç»†ç›®å½•ç»“æ„

```
tg_bot_picture_v1/
â”œâ”€â”€ main.py                    # ğŸ“ åº”ç”¨ç¨‹åºå…¥å£ç‚¹
â”œâ”€â”€ requirements.txt           # ğŸ“¦ Pythonä¾èµ–ç®¡ç†
â”œâ”€â”€ ecosystem.config.js        # ğŸ”§ PM2è¿›ç¨‹ç®¡ç†é…ç½®
â”œâ”€â”€ pm2_manager.sh            # ğŸ› ï¸ PM2ç®¡ç†è„šæœ¬
â”œâ”€â”€ README.md                 # ğŸ“š é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ å¿«é€Ÿå¯åŠ¨.md               # ğŸš€ å¿«é€Ÿå¯åŠ¨æŒ‡å—
â”‚
â”œâ”€â”€ src/                      # ğŸ’» æ ¸å¿ƒæºä»£ç ç›®å½•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                 # ğŸ”§ åº”ç”¨æ ¸å¿ƒå±‚
â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”œâ”€â”€ app.py           # åº”ç”¨ç¨‹åºé…ç½®å’Œåˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ container.py     # ä¾èµ–æ³¨å…¥å®¹å™¨ (DI Container)
â”‚   â”‚   â””â”€â”€ lifecycle.py     # åº”ç”¨ç”Ÿå‘½å‘¨æœŸç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/              # ğŸ›ï¸ é¢†åŸŸå±‚ - ä¸šåŠ¡é€»è¾‘æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ models/          # ğŸ“Š é¢†åŸŸæ¨¡å‹/å®ä½“
â”‚   â”‚   â””â”€â”€ services/        # ğŸ”„ é¢†åŸŸæœåŠ¡
â”‚   â”‚       â”œâ”€â”€ user_service.py           # ç”¨æˆ·ç®¡ç†æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ payment_service.py        # æ”¯ä»˜å¤„ç†æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ image_service.py          # å›¾åƒå¤„ç†æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ session_service.py        # ä¼šè¯ç®¡ç†æœåŠ¡
â”‚   â”‚       â”œâ”€â”€ system_config_service.py  # ç³»ç»Ÿé…ç½®æœåŠ¡
â”‚   â”‚       â””â”€â”€ action_record_service.py  # æ“ä½œè®°å½•æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/      # ğŸ—ï¸ åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ database/        # ğŸ’¾ æ•°æ®æŒä¹…åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ supabase_manager.py      # Supabaseæ•°æ®åº“ç®¡ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ repositories/            # æ•°æ®ä»“å‚¨æ¨¡å¼å®ç°
â”‚   â”‚   â”‚       â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚       â”œâ”€â”€ base_repository.py   # åŸºç¡€ä»“å‚¨æŠ½è±¡
â”‚   â”‚   â”‚       â”œâ”€â”€ user_repository.py   # ç”¨æˆ·æ•°æ®ä»“å‚¨
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_user_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_payment_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_image_task_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_session_record_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_point_record_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_daily_checkin_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_user_session_repository.py
â”‚   â”‚   â”‚       â”œâ”€â”€ supabase_user_action_record_repository.py
â”‚   â”‚   â”‚       â””â”€â”€ supabase_system_config_repository.py
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ external_apis/   # ğŸŒ å¤–éƒ¨APIé›†æˆ
â”‚   â”‚   â”‚   â”œâ”€â”€ __init__.py
â”‚   â”‚   â”‚   â”œâ”€â”€ clothoff_api.py          # ClothOffå›¾åƒå¤„ç†API
â”‚   â”‚   â”‚   â””â”€â”€ payment_api.py           # æ”¯ä»˜APIé›†æˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ messaging/       # ğŸ“¨ æ¶ˆæ¯å¤„ç†åŸºç¡€è®¾æ–½
â”‚   â”‚   â””â”€â”€ monitoring/      # ğŸ“Š ç›‘æ§å’Œæ—¥å¿—åŸºç¡€è®¾æ–½
â”‚   â”‚
â”‚   â”œâ”€â”€ interfaces/          # ğŸ”Œ æ¥å£é€‚é…å±‚
â”‚   â”‚   â”œâ”€â”€ telegram/        # ğŸ¤– Telegram Botæ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ bot.py                   # Telegram Botä¸»æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ui_handler.py            # UIäº¤äº’å¤„ç†å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ user_state_manager.py    # ç”¨æˆ·çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ handlers/                # å„ç§å¤„ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ callback_manager.py  # å›è°ƒå¤„ç†ç®¡ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ message_handlers.py  # æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ image_processing.py  # å›¾åƒå¤„ç†å¤„ç†å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ callback/            # å›è°ƒå¤„ç†å™¨é›†åˆ
â”‚   â”‚   â”‚       â””â”€â”€ command/             # å‘½ä»¤å¤„ç†å™¨é›†åˆ
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ web/             # ğŸŒ Web APIæ¥å£
â”‚   â”‚   â””â”€â”€ cli/             # ğŸ’» å‘½ä»¤è¡Œæ¥å£
â”‚   â”‚
â”‚   â””â”€â”€ utils/               # ğŸ› ï¸ é€šç”¨å·¥å…·å±‚
â”‚       â”œâ”€â”€ config/          # âš™ï¸ é…ç½®ç®¡ç†
â”‚       â”œâ”€â”€ constants/       # ğŸ“‹ å¸¸é‡å®šä¹‰
â”‚       â””â”€â”€ helpers/         # ğŸ”§ è¾…åŠ©å‡½æ•°
â”‚
â”œâ”€â”€ tests/                   # ğŸ§ª æµ‹è¯•ä»£ç ç›®å½•
â”‚   â”œâ”€â”€ test_telegram_bot.py             # Telegram Botæµ‹è¯•
â”‚   â”œâ”€â”€ test_user_service.py             # ç”¨æˆ·æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_payment_service.py          # æ”¯ä»˜æœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_image_service.py            # å›¾åƒæœåŠ¡æµ‹è¯•
â”‚   â”œâ”€â”€ test_clothoff_api.py             # ClothOff APIæµ‹è¯•
â”‚   â”œâ”€â”€ test_database.py                 # æ•°æ®åº“æµ‹è¯•
â”‚   â”œâ”€â”€ test_supabase.py                 # Supabaseé›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_integration.py              # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ test_webhook_handler.py          # Webhookå¤„ç†å™¨æµ‹è¯•
â”‚   â”œâ”€â”€ quick_test.py                    # å¿«é€Ÿæµ‹è¯•è„šæœ¬
â”‚   â””â”€â”€ setup_supabase.py                # Supabaseè®¾ç½®è„šæœ¬
â”‚
â”œâ”€â”€ scripts/                 # ğŸ“œ è¿ç»´å’Œæ•°æ®åº“è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ migrate_to_supabase.py           # Supabaseè¿ç§»è„šæœ¬
â”‚   â”œâ”€â”€ check_migration_status.py        # è¿ç§»çŠ¶æ€æ£€æŸ¥
â”‚   â”œâ”€â”€ supabase_tables.sql              # æ•°æ®åº“è¡¨ç»“æ„
â”‚   â”œâ”€â”€ manage_webhook.sh                # Webhookç®¡ç†è„šæœ¬
â”‚   â””â”€â”€ test_integration.py              # é›†æˆæµ‹è¯•è„šæœ¬
â”‚
â”œâ”€â”€ logs/                    # ğŸ“ æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ data/                    # ğŸ“ æ•°æ®å­˜å‚¨ç›®å½•
â””â”€â”€ docs/                    # ğŸ“– æ–‡æ¡£ç›®å½•
```

## æ ¸å¿ƒç»„ä»¶äº¤äº’æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    HTTP/Webhook    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Telegram  â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º â”‚  Telegram Bot   â”‚
â”‚   Platform  â”‚                    â”‚   Interface     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                             â”‚
                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Handler Pipeline                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚   Message   â”‚  â”‚  Callback   â”‚  â”‚   Image     â”‚             â”‚
â”‚  â”‚  Handlers   â”‚  â”‚  Handlers   â”‚  â”‚ Processing  â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Domain Services                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚    User     â”‚  â”‚   Payment   â”‚  â”‚    Image    â”‚             â”‚
â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚  â”‚   Service   â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Infrastructure Services                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
â”‚  â”‚  Supabase   â”‚  â”‚  ClothOff   â”‚  â”‚   Payment   â”‚             â”‚
â”‚  â”‚ Repositoriesâ”‚  â”‚     API     â”‚  â”‚     API     â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¶æ„ç‰¹ç‚¹

### ğŸ—ï¸ è®¾è®¡æ¨¡å¼
- **Clean Architecture**: åˆ†å±‚æ¶æ„ï¼Œä¾èµ–å€’ç½®
- **Domain Driven Design (DDD)**: é¢†åŸŸé©±åŠ¨è®¾è®¡
- **Repository Pattern**: æ•°æ®è®¿é—®æŠ½è±¡
- **Dependency Injection**: ä¾èµ–æ³¨å…¥å®¹å™¨ç®¡ç†
- **CQRS**: å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»

### ğŸ”§ æ ¸å¿ƒæŠ€æœ¯æ ˆ
- **è¯­è¨€**: Python 3.x
- **Webæ¡†æ¶**: Python-telegram-bot
- **æ•°æ®åº“**: Supabase (PostgreSQL)
- **å¤–éƒ¨API**: ClothOffå›¾åƒå¤„ç†API
- **éƒ¨ç½²**: PM2è¿›ç¨‹ç®¡ç†
- **ä¾èµ–ç®¡ç†**: pip requirements.txt

### ğŸ“Š ä¸»è¦åŠŸèƒ½æ¨¡å—
1. **ç”¨æˆ·ç®¡ç†**: æ³¨å†Œã€è®¤è¯ã€ç§¯åˆ†ç³»ç»Ÿ
2. **å›¾åƒå¤„ç†**: åŸºäºAIçš„å›¾åƒå¤„ç†æœåŠ¡
3. **æ”¯ä»˜ç³»ç»Ÿ**: ç§¯åˆ†å……å€¼å’Œæ¶ˆè´¹ç®¡ç†
4. **ä¼šè¯ç®¡ç†**: ç”¨æˆ·çŠ¶æ€å’Œå¯¹è¯æµç¨‹
5. **ç³»ç»Ÿé…ç½®**: åŠ¨æ€é…ç½®ç®¡ç†
6. **æ“ä½œè®°å½•**: ç”¨æˆ·è¡Œä¸ºè¿½è¸ªå’Œå®¡è®¡

### ğŸš€ éƒ¨ç½²å’Œè¿ç»´
- **è¿›ç¨‹ç®¡ç†**: PM2 ecosystemé…ç½®
- **æ—¥å¿—ç®¡ç†**: ç»“æ„åŒ–æ—¥å¿—è®°å½•
- **å¥åº·æ£€æŸ¥**: æœåŠ¡ç›‘æ§å’ŒçŠ¶æ€æ£€æŸ¥
- **æ•°æ®è¿ç§»**: Supabaseæ•°æ®åº“è¿ç§»è„šæœ¬ 